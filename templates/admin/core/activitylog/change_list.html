{% extends "admin/change_list.html" %}

{% block content %}
  <div class="module" style="margin-bottom:16px;">
    <div class="form-row">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:16px; flex-wrap: wrap;">
        <h2 style="margin: 8px 0;">Latest Backup</h2>
        <form action="{{ run_backup_url }}" method="post" style="margin:0;">
          {% csrf_token %}
          <button type="submit" class="button" style="
              font-size: 18px;
              line-height: 1.2;
              padding: 10px 18px;
              border-radius: 6px;
              display: inline-flex;
              align-items: center;
              gap: 8px;
          ">
            â–¶ Run backup now
          </button>
        </form>
      </div>

      {% if backup_stale %}
        <div class="errornote" style="margin:8px 0;">Latest backup is missing, failed, or older than 24 hours. Please run a new backup.</div>
      {% endif %}

      {% if latest_backup %}
        <div style="padding:8px 0;">
          <p><strong>When:</strong> {{ latest_backup.timestamp|date:"M d, Y H:i:s" }}</p>
          <p><strong>Status:</strong>
            {% if latest_backup.after_data.status == 'success' %}
              <span style="color: #067d17; font-weight:600;">Success</span>
            {% else %}
              <span style="color: #ba2121; font-weight:600;">Error</span>
            {% endif %}
          </p>
          <p><strong>Engine:</strong> {{ latest_backup.after_data.engine }}</p>
          {% if latest_backup.after_data.destination %}
            <p><strong>Destination:</strong> {{ latest_backup.after_data.destination }}</p>
          {% endif %}
          {% if latest_backup.after_data.rotation_removed is not None %}
            <p><strong>Old backups removed:</strong> {{ latest_backup.after_data.rotation_removed }}</p>
          {% endif %}
          {% if latest_backup.after_data.reason %}
            <p><strong>Reason:</strong> {{ latest_backup.after_data.reason }}</p>
          {% endif %}
        </div>
      {% else %}
        <p>No backup logs yet.</p>
      {% endif %}
    </div>
  </div>

  {{ block.super }}
{% endblock %}
