{% extends "admin/change_list.html" %}

{% block content %}
  <div class="module" style="margin-bottom:16px;">
    <div class="form-row">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:16px; flex-wrap: wrap;">
        <h2 style="margin: 8px 0;">Latest Backup</h2>
        <div style="display: flex; gap: 12px; align-items: center;">
          <a href="{{ backup_manager_url }}" class="button" style="
              font-size: 14px;
              line-height: 1.2;
              padding: 10px 20px;
              border-radius: 8px;
              display: inline-flex;
              align-items: center;
              gap: 8px;
              background: #417690;
              color: #ffffff;
              border: none;
              font-weight: 600;
              cursor: pointer;
              transition: all 0.2s ease;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
              text-decoration: none;
          "
          onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.15)';"
          onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0, 0, 0, 0.1)';"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
            </svg>
            Backup Manager
          </a>
          <form action="{{ run_backup_url }}" method="post" style="margin:0;">
            {% csrf_token %}
            <button type="submit" class="button" style="
                font-size: 14px;
                line-height: 1.2;
                padding: 10px 20px;
                border-radius: 8px;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                background: #067d17;
                color: #ffffff;
                border: none;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s ease;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            "
            onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.15)';"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0, 0, 0, 0.1)';"
            >
              <span style="display: inline-flex; align-items: center;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor" style="margin-right: 8px;">
                  <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm4.82 7.818l-5.528 5.528a.75.75 0 01-1.06 0L7.18 12.293a.75.75 0 111.06-1.06l2.122 2.121 4.528-4.528a.75.75 0 111.06 1.06l-.13.132z"/>
                </svg>
                Run Backup Now
              </span>
            </button>
          </form>
        </div>
      </div>

      {% if backup_stale %}
        <div class="errornote" style="margin:8px 0;">Latest backup is missing, failed, or older than 24 hours. Please run a new backup.</div>
      {% endif %}

      {% if latest_backup %}
        <div style="padding:8px 0;">
          <p><strong>When:</strong> {{ latest_backup.timestamp|date:"M d, Y H:i:s" }}</p>
          <p><strong>Status:</strong>
            {% if latest_backup.after_data.status == 'success' %}
              <span style="color: #067d17; font-weight:600;">Success</span>
            {% else %}
              <span style="color: #ba2121; font-weight:600;">Error</span>
            {% endif %}
          </p>
          <p><strong>Engine:</strong> {{ latest_backup.after_data.engine }}</p>
          {% if latest_backup.after_data.destination %}
            <p><strong>Destination:</strong> {{ latest_backup.after_data.destination }}</p>
          {% endif %}
          {% if latest_backup.after_data.rotation_removed is not None %}
            <p><strong>Old backups removed:</strong> {{ latest_backup.after_data.rotation_removed }}</p>
          {% endif %}
          {% if latest_backup.after_data.reason %}
            <p><strong>Reason:</strong> {{ latest_backup.after_data.reason }}</p>
          {% endif %}
        </div>
      {% else %}
        <p>No backup logs yet.</p>
      {% endif %}
    </div>
  </div>

  {{ block.super }}
{% endblock %}
