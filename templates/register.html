{% extends 'base.html' %}

{% block title %}Register - Agrostudies Registration System{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/register-redesigned.css">
{% endblock %}

{% block content %}
<div class="register-container">
    <div class="register-card">
        <!-- Header Section -->
        <div class="register-header">
            <h1>Create Your Account</h1>
            <p>Join Agrostudies and explore amazing opportunities</p>
        </div>

        <!-- OAuth Status Display -->
        {% if oauth_data %}
        <div class="oauth-badge-box">
            <div class="oauth-badge-content">
                <i class="fas fa-check-circle"></i>
                <div>
                    <strong>Email Verified</strong>
                    <p>Your {{ oauth_data.provider|title }} account has been verified</p>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Registration Form -->
        <form id="registerForm" method="POST" enctype="multipart/form-data" class="register-form" novalidate>
            {% csrf_token %}

            <!-- Step 1: Account Information -->
            <div class="form-section">
                <div class="section-title">
                    <span class="step-number">1</span>
                    <h3>Account Setup</h3>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.username.id_for_label }}">Username *</label>
                        {{ form.username }}
                        <small>3-20 characters: letters, numbers, underscores</small>
                        {% if form.username.errors %}
                            <span class="error-text">{{ form.username.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.email.id_for_label }}">Email Address *
                            {% if oauth_data %}<span class="verified-badge">âœ“ Verified</span>{% endif %}
                        </label>
                        {% if oauth_data %}
                            <input type="email" class="form-control readonly" value="{{ oauth_data.email }}" readonly>
                            <small>Pre-filled and verified by {{ oauth_data.provider|title }}</small>
                        {% else %}
                            {{ form.email }}
                            {% if form.email.errors %}
                                <span class="error-text">{{ form.email.errors }}</span>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>

                {% if not oauth_data %}
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.confirm_email.id_for_label }}">Confirm Email *</label>
                        {{ form.confirm_email }}
                        {% if form.confirm_email.errors %}
                            <span class="error-text">{{ form.confirm_email.errors }}</span>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <div class="form-row">
                    {% if oauth_data %}
                    <div class="form-group">
                        <label>Password *</label>
                        <div class="oauth-notice">
                            <i class="fas fa-lock"></i>
                            <span>Secure password auto-generated for OAuth accounts</span>
                        </div>
                    </div>
                    {% else %}
                    <div class="form-group">
                        <label for="{{ form.password1.id_for_label }}">Password *</label>
                        {{ form.password1 }}
                        <small>At least 8 characters with uppercase, lowercase, and numbers</small>
                        {% if form.password1.errors %}
                            <span class="error-text">{{ form.password1.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.password2.id_for_label }}">Confirm Password *</label>
                        {{ form.password2 }}
                        {% if form.password2.errors %}
                            <span class="error-text">{{ form.password2.errors }}</span>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Step 2: Personal Information -->
            <div class="form-section">
                <div class="section-title">
                    <span class="step-number">2</span>
                    <h3>Personal Information</h3>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.first_name.id_for_label }}">First Name *</label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                            <span class="error-text">{{ form.first_name.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.last_name.id_for_label }}">Last Name *</label>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}
                            <span class="error-text">{{ form.last_name.errors }}</span>
                        {% endif %}
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.date_of_birth.id_for_label }}">Date of Birth *</label>
                        {{ form.date_of_birth }}
                        {% if form.date_of_birth.errors %}
                            <span class="error-text">{{ form.date_of_birth.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.gender.id_for_label }}">Gender *</label>
                        {{ form.gender }}
                        {% if form.gender.errors %}
                            <span class="error-text">{{ form.gender.errors }}</span>
                        {% endif %}
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.nationality.id_for_label }}">Nationality *</label>
                        {{ form.nationality }}
                        {% if form.nationality.errors %}
                            <span class="error-text">{{ form.nationality.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.phone_number.id_for_label }}">Phone Number</label>
                        {{ form.phone_number }}
                        {% if form.phone_number.errors %}
                            <span class="error-text">{{ form.phone_number.errors }}</span>
                        {% endif %}
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="{{ form.address.id_for_label }}">Address</label>
                    {{ form.address }}
                    {% if form.address.errors %}
                        <span class="error-text">{{ form.address.errors }}</span>
                    {% endif %}
                </div>
            </div>

            <!-- Step 3: Passport Information -->
            <div class="form-section">
                <div class="section-title">
                    <span class="step-number">3</span>
                    <h3>Passport Information</h3>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.passport_number.id_for_label }}">Passport Number *</label>
                        {{ form.passport_number }}
                        {% if form.passport_number.errors %}
                            <span class="error-text">{{ form.passport_number.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.confirm_passport_number.id_for_label }}">Confirm Passport Number *</label>
                        {{ form.confirm_passport_number }}
                        {% if form.confirm_passport_number.errors %}
                            <span class="error-text">{{ form.confirm_passport_number.errors }}</span>
                        {% endif %}
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.passport_issue_date.id_for_label }}">Issue Date *</label>
                        {{ form.passport_issue_date }}
                        {% if form.passport_issue_date.errors %}
                            <span class="error-text">{{ form.passport_issue_date.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.passport_expiry_date.id_for_label }}">Expiry Date *</label>
                        {{ form.passport_expiry_date }}
                        {% if form.passport_expiry_date.errors %}
                            <span class="error-text">{{ form.passport_expiry_date.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.place_of_issue.id_for_label }}">Place of Issue</label>
                        {{ form.place_of_issue }}
                        {% if form.place_of_issue.errors %}
                            <span class="error-text">{{ form.place_of_issue.errors }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Step 4: Academic Information -->
            <div class="form-section">
                <div class="section-title">
                    <span class="step-number">4</span>
                    <h3>Academic Background</h3>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.highest_education_level.id_for_label }}">Highest Education Level *</label>
                        {{ form.highest_education_level }}
                        {% if form.highest_education_level.errors %}
                            <span class="error-text">{{ form.highest_education_level.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.institution_name.id_for_label }}">Institution Name *</label>
                        {{ form.institution_name }}
                        {% if form.institution_name.errors %}
                            <span class="error-text">{{ form.institution_name.errors }}</span>
                        {% endif %}
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.field_of_study.id_for_label }}">Field of Study *</label>
                        {{ form.field_of_study }}
                        {% if form.field_of_study.errors %}
                            <span class="error-text">{{ form.field_of_study.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.graduation_year.id_for_label }}">Graduation Year *</label>
                        {{ form.graduation_year }}
                        {% if form.graduation_year.errors %}
                            <span class="error-text">{{ form.graduation_year.errors }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Step 5: Additional Information -->
            <div class="form-section">
                <div class="section-title">
                    <span class="step-number">5</span>
                    <h3>Additional Details</h3>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.preferred_country.id_for_label }}">Preferred Country</label>
                        {{ form.preferred_country }}
                        <small>Country you prefer for opportunities</small>
                        {% if form.preferred_country.errors %}
                            <span class="error-text">{{ form.preferred_country.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group checkbox-group">
                        <label>Relocation</label>
                        <div class="form-check">
                            {{ form.willing_to_relocate }}
                            <label class="form-check-label" for="{{ form.willing_to_relocate.id_for_label }}">
                                Willing to relocate for opportunities
                            </label>
                        </div>
                        {% if form.willing_to_relocate.errors %}
                            <span class="error-text">{{ form.willing_to_relocate.errors }}</span>
                        {% endif %}
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="{{ form.special_requirements.id_for_label }}">Special Requirements/Notes</label>
                    {{ form.special_requirements }}
                    <small>Any special requirements, dietary restrictions, medical conditions, etc.</small>
                    {% if form.special_requirements.errors %}
                        <span class="error-text">{{ form.special_requirements.errors }}</span>
                    {% endif %}
                </div>
            </div>

            <!-- Step 6: Document Uploads -->
            <div class="form-section">
                <div class="section-title">
                    <span class="step-number">6</span>
                    <h3>Document Uploads</h3>
                    <p class="section-subtitle">Optional - You can upload these documents later</p>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.profile_image.id_for_label }}">Profile Photo</label>
                        {{ form.profile_image }}
                        <small>JPG, PNG, or GIF (max 5MB)</small>
                        {% if form.profile_image.errors %}
                            <span class="error-text">{{ form.profile_image.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.passport_scan.id_for_label }}">Passport Scan</label>
                        {{ form.passport_scan }}
                        <small>PDF, JPG, or PNG (max 5MB)</small>
                        {% if form.passport_scan.errors %}
                            <span class="error-text">{{ form.passport_scan.errors }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.academic_certificate.id_for_label }}">Academic Certificate</label>
                        {{ form.academic_certificate }}
                        <small>PDF, JPG, or PNG (max 5MB)</small>
                        {% if form.academic_certificate.errors %}
                            <span class="error-text">{{ form.academic_certificate.errors }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Form Errors -->
            {% if form.non_field_errors %}
                <div class="alert-error">
                    <i class="fas fa-exclamation-circle"></i>
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            <!-- Hidden field for OAuth provider -->
            {% if oauth_data %}
                <input type="hidden" name="oauth_provider" value="{{ oauth_data.provider }}">
            {% endif %}

            <!-- Submit Button -->
            <div class="form-actions">
                <button type="submit" class="btn-primary">
                    <i class="fas fa-user-check"></i>
                    Create Account
                </button>
            </div>

            <!-- Sign In Link -->
            <div class="form-footer">
                <p>Already have an account? <a href="{% url 'login' %}">Sign in here</a></p>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/register-validation.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('registerForm');
    
    // Form submission validation
    form.addEventListener('submit', function(e) {
        if (!form.checkValidity()) {
            e.preventDefault();
            e.stopPropagation();
        }
        form.classList.add('was-validated');
    }, false);
    
    // Email confirmation validation
    const emailInputs = document.querySelectorAll('input[id*="email"]');
    const confirmEmailField = document.querySelector('input[name="confirm_email"]');
    
    if (confirmEmailField && emailInputs.length > 0) {
        confirmEmailField.addEventListener('blur', function() {
            const emailField = document.querySelector('input[name="email"]');
            if (emailField && emailField.value !== confirmEmailField.value) {
                confirmEmailField.classList.add('error');
                confirmEmailField.setCustomValidity('Email addresses do not match');
            } else if (emailField) {
                confirmEmailField.classList.remove('error');
                confirmEmailField.setCustomValidity('');
            }
        });
    }
    
    // Passport number confirmation validation
    const passportField = document.querySelector('input[name="passport_number"]');
    const confirmPassportField = document.querySelector('input[name="confirm_passport_number"]');
    
    if (confirmPassportField && passportField) {
        confirmPassportField.addEventListener('blur', function() {
            if (passportField.value !== confirmPassportField.value) {
                confirmPassportField.classList.add('error');
                confirmPassportField.setCustomValidity('Passport numbers do not match');
            } else {
                confirmPassportField.classList.remove('error');
                confirmPassportField.setCustomValidity('');
            }
        });
    }
});
</script>
{% endblock %}
