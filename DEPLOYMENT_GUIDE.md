# üìö Complete Deployment Guide for AgriDjangoPortal

## üöÄ Quick Start Deployment on Render

### Prerequisites
1. GitHub account with your code repository
2. Render account (free tier available)
3. Updated `render.yaml` file in your repository root

### Step-by-Step Deployment

1. **Prepare Your Repository**
   ```bash
   # Use the optimized requirements
   mv requirements_optimized.txt requirements.txt
   
   # Use the fixed render.yaml
   mv render_fixed.yaml render.yaml
   
   # Commit changes
   git add .
   git commit -m "Optimize dependencies and fix deployment configuration"
   git push origin main
   ```

2. **Deploy on Render**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click "New +" ‚Üí "Blueprint"
   - Connect your GitHub repository
   - Select your repository and branch
   - Render will automatically detect `render.yaml`
   - Click "Apply" to start deployment

3. **Verify Deployment**
   - Wait for build to complete (5-10 minutes)
   - Check the logs for any errors
   - Visit your app URL: `https://agridjangoportal.onrender.com`
   - Login with admin credentials (check Render environment variables for password)

## üîß Configuration Details

### Environment Variables (Set in Render Dashboard)
```env
SECRET_KEY=<auto-generated>
DEBUG=False
ALLOWED_HOSTS=agridjangoportal.onrender.com
DATABASE_URL=<auto-from-database>
DJANGO_SUPERUSER_USERNAME=admin
DJANGO_SUPERUSER_EMAIL=admin@example.com
DJANGO_SUPERUSER_PASSWORD=<auto-generated>
```

### Database Configuration
- PostgreSQL database is automatically created
- Connection string is injected via `DATABASE_URL`
- Migrations run automatically on deploy

### Static Files
- Collected automatically during build
- Served via WhiteNoise middleware
- No additional configuration needed

## üîê Superuser Creation Fix

The original issue with superuser creation was in the `postDeployCommand`. 

**Problem:** Using pipe (`|`) for multi-line commands
```yaml
postDeployCommand: |
  python manage.py migrate
  python manage.py createsu
```

**Solution:** Chain commands with `&&`
```yaml
postDeployCommand: python manage.py migrate --noinput && python manage.py createsu
```

## üíæ Automatic Backups

### How It Works
1. Cron job runs daily at 5:00 PM UTC
2. Creates timestamped backup in `backups/` directory
3. Keeps last 30 backups (configurable)
4. Logs all backup operations

### Manual Backup
```bash
python manage.py scheduled_backup
```

### Restore from Backup
```bash
# List available backups
ls backups/

# Restore specific backup
python manage.py loaddata backups/db-sqlite-20250824-142410.sqlite3
```

## üßπ System Cleanup Checklist

### Before Deployment
- [ ] Remove test files (`create_*.py`, `test_*.py`)
- [ ] Delete unused apps (`agri_core/`)
- [ ] Clean up backup view files (`views_new.py`, `views_updated.py`)
- [ ] Remove Windows-specific scripts (`.bat`, `.ps1`)
- [ ] Use optimized requirements.txt
- [ ] Add `.gitignore` file

### After Deployment
- [ ] Verify superuser was created
- [ ] Test login functionality
- [ ] Check static files are loading
- [ ] Verify database connection
- [ ] Test backup cron job

## üêõ Troubleshooting

### Superuser Not Created
1. Check Render logs for errors
2. Verify environment variables are set
3. Run manually: `python manage.py createsu`

### Static Files Not Loading
1. Check `STATIC_ROOT` setting
2. Verify `whitenoise` is installed
3. Run `python manage.py collectstatic`

### Database Connection Issues
1. Check `DATABASE_URL` format
2. Verify PostgreSQL addon is attached
3. Check database credentials

### Migration Errors
1. Run migrations locally first
2. Check for model conflicts
3. Reset database if needed

## üìä Monitoring

### Health Checks
- Render automatically pings `/` endpoint
- Configure custom health endpoint if needed

### Logs
- View in Render dashboard
- Filter by service (web, cron)
- Download for analysis

### Performance
- Monitor response times
- Check memory usage
- Scale dynos if needed

## üîÑ Updates and Maintenance

### Deploying Updates
```bash
git add .
git commit -m "Update description"
git push origin main
# Render auto-deploys if enabled
```

### Manual Deploy
- Go to Render dashboard
- Click "Manual Deploy"
- Select branch and commit

### Database Migrations
- Migrations run automatically on deploy
- For complex migrations, run manually first

## üìù Important Notes

1. **Security**
   - Never commit `.env` files
   - Use strong passwords
   - Enable 2FA on Render
   - Regularly update dependencies

2. **Performance**
   - Free tier has limitations
   - Apps sleep after 15 minutes of inactivity
   - First request after sleep is slow

3. **Backups**
   - Regular backups are crucial
   - Test restore process periodically
   - Keep offsite backups for production

4. **Monitoring**
   - Set up alerts for errors
   - Monitor resource usage
   - Track user activity

## üÜò Support Resources

- [Render Documentation](https://render.com/docs)
- [Django Deployment Checklist](https://docs.djangoproject.com/en/4.2/howto/deployment/checklist/)
- [WhiteNoise Documentation](http://whitenoise.evans.io/)
- [PostgreSQL on Render](https://render.com/docs/databases)

## üìã Pre-Deployment Checklist

- [ ] All tests passing
- [ ] Requirements optimized
- [ ] Environment variables configured
- [ ] Database migrations ready
- [ ] Static files configured
- [ ] Superuser creation script working
- [ ] Backup system configured
- [ ] Security settings reviewed
- [ ] Performance optimizations applied
- [ ] Documentation updated

---

**Last Updated:** August 2025
**Version:** 1.0
**Maintained By:** AgriDjangoPortal Team
